// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id         String      @id @default(cuid())
  firebase_uid    String      @unique
  username        String?     @unique
  email           String      @unique
  first_name      String
  last_name       String
  status          UserStatus
  role            UserRole

  avatar_key       String?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

model Show {
  show_id          String      @id @default(cuid())
  show_name        String      @unique
  show_description String
  venue            String      
  address          String
  show_status      ShowStatus
  show_start_date  DateTime    @db.Date
  show_end_date    DateTime    @db.Date
  show_image_key   String?

  scheds           Sched[]

  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

enum ShowStatus {
  UPCOMING
  DRAFT
  OPEN
  CLOSED
  ON_GOING
  CANCELLED
  POSTPONED
}

model Sched {
  sched_id          String      @id @default(cuid())
  sched_date        DateTime    @db.Date
  sched_start_time  DateTime    @db.Time
  sched_end_time    DateTime    @db.Time

  show_id           String
  show              Show        @relation(fields: [show_id], references: [show_id])
  seatmaps          Seatmap[]

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Seatmap {
  seatmap_id        String      @id @default(cuid())
  seatmap_name      String
  seatmap_json      Json

  sched_id          String
  sched             Sched       @relation(fields: [sched_id], references: [sched_id])
  seat_categories   SeatCategory[]
  seats             Seat[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([sched_id, seatmap_name])
}

model SeatCategory {
  seat_category_id  String      @id @default(cuid())
  category_name     String

  seatmap_id        String
  seatmap           Seatmap     @relation(fields: [seatmap_id], references: [seatmap_id])
  seats             Seat[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

model Seat {
  seat_id           String      @id @default(cuid())
  seat_number        String
  seat_status       String

  seat_category_id  String
  seat_category     SeatCategory @relation(fields: [seat_category_id], references: [seat_category_id])

  seatmap_id        String
  seatmap           Seatmap     @relation(fields: [seatmap_id], references: [seatmap_id])

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}
