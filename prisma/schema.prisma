// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id         String      @id @default(cuid())
  firebase_uid    String      @unique
  username        String?     @unique
  email           String      @unique
  first_name      String
  last_name       String
  status          UserStatus
  role            UserRole

  avatar_key       String?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

model Show {
  show_id          String      @id @default(cuid())
  show_name        String      @unique
  show_description String
  venue            String      
  address          String
  show_status      ShowStatus
  show_start_date  DateTime    @db.Date
  show_end_date    DateTime    @db.Date
  show_image_key   String?

  seatmap_id       String?
  seatmap          Seatmap?    @relation(fields: [seatmap_id], references: [seatmap_id])

  scheds           Sched[]
  seatCategories   SeatCategory[]

  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

enum ShowStatus {
  UPCOMING
  DRAFT
  OPEN
  CLOSED
  ON_GOING
  CANCELLED
  POSTPONED
}

model Sched {
  sched_id          String      @id @default(cuid())
  sched_date        DateTime    @db.Date
  sched_start_time  DateTime    @db.Time
  sched_end_time    DateTime    @db.Time

  show_id           String?
  show              Show?       @relation(fields: [show_id], references: [show_id])

  seatAssignments   SeatAssignment[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

model Seatmap {
  seatmap_id        String      @id @default(cuid())
  seatmap_name      String      @unique
  seatmap_json      Json
  seatmap_status    SeatmapStatus @default(ACTIVE)

  shows             Show[]
  seatCategories    SeatCategory[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

enum SeatmapStatus {
  ACTIVE
  DISABLED
}

model SeatCategory {
  seat_category_id  String      @id @default(cuid())
  category_name     String
  price             String      @default("0")
  version           Int         @unique @default(autoincrement())

  seatmap_id        String?
  seatmap           Seatmap?    @relation(fields: [seatmap_id], references: [seatmap_id])

  show_id           String?
  show              Show?       @relation(fields: [show_id], references: [show_id])

  seats             Seat[]
  seatAssignments   SeatAssignment[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

model Seat {
  seat_id           String      @id @default(cuid())
  seat_number       String

  seat_category_id  String?
  seat_category     SeatCategory? @relation(fields: [seat_category_id], references: [seat_category_id])

  seatAssignments   SeatAssignment[]

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

enum SeatStatus {
  OPEN
  RESERVED
}

model SeatAssignment {
  seat_assignment_id String @id @default(cuid())
  seat_status        SeatStatus @default(OPEN)

  seat_id            String
  sched_id           String
  seat_category_id   String
  seat               Seat @relation(fields: [seat_id], references: [seat_id])
  sched              Sched @relation(fields: [sched_id], references: [sched_id])
  seat_category      SeatCategory @relation(fields: [seat_category_id], references: [seat_category_id])

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}
