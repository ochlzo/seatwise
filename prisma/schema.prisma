generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  user_id      String        @id @default(cuid())
  firebase_uid String        @unique
  username     String?       @unique
  email        String        @unique
  first_name   String
  last_name    String
  status       UserStatus
  role         UserRole
  avatar_key   String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  reservations Reservation[]
  reviews      Review[]
}

model Show {
  show_id          String        @id @default(cuid())
  show_name        String        @unique
  show_description String
  venue            String
  address          String
  show_status      ShowStatus
  show_start_date  DateTime      @db.Date
  show_end_date    DateTime      @db.Date
  show_image_key   String?
  seatmap_id       String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  categorySets     CategorySet[]
  reservations     Reservation[]
  reviews          Review[]
  scheds           Sched[]
  seatmap          Seatmap?      @relation(fields: [seatmap_id], references: [seatmap_id])
}

model Sched {
  sched_id         String           @id @default(cuid())
  sched_date       DateTime         @db.Date
  sched_start_time DateTime         @db.Time(6)
  sched_end_time   DateTime         @db.Time(6)
  show_id          String
  category_set_id  String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  categorySet      CategorySet?     @relation(fields: [category_set_id], references: [category_set_id])
  show             Show             @relation(fields: [show_id], references: [show_id])
  reservations     Reservation[]
  seatAssignments  SeatAssignment[]
  sets             Set[]

  @@index([show_id])
  @@index([category_set_id])
}

model Seatmap {
  seatmap_id     String         @id @default(cuid())
  seatmap_name   String         @unique
  seatmap_json   Json
  seatmap_status SeatmapStatus  @default(ACTIVE)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  seats          Seat[]
  seatCategories SeatCategory[]
  shows          Show[]
}

model Seat {
  seat_id         String           @id @default(cuid())
  seat_number     String
  seatmap_id      String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  seatmap         Seatmap          @relation(fields: [seatmap_id], references: [seatmap_id])
  seatAssignments SeatAssignment[]

  @@unique([seatmap_id, seat_number])
  @@index([seatmap_id])
}

model SeatCategory {
  seat_category_id String            @id @default(cuid())
  category_name    String
  price            Decimal           @default(0.00) @db.Decimal(10, 2)
  color_code       ColorCodes
  seatmap_id       String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  categorySetItems CategorySetItem[]
  seatmap          Seatmap           @relation(fields: [seatmap_id], references: [seatmap_id])
  sets             Set[]

  @@unique([seatmap_id, category_name, price, color_code])
  @@index([seatmap_id])
}

model CategorySet {
  category_set_id String            @id @default(cuid())
  set_name        String
  show_id         String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  show            Show              @relation(fields: [show_id], references: [show_id])
  items           CategorySetItem[]
  scheds          Sched[]

  @@unique([show_id, set_name])
  @@index([show_id])
}

model CategorySetItem {
  category_set_id  String
  seat_category_id String
  categorySet      CategorySet  @relation(fields: [category_set_id], references: [category_set_id])
  seatCategory     SeatCategory @relation(fields: [seat_category_id], references: [seat_category_id])

  @@id([category_set_id, seat_category_id])
  @@index([seat_category_id])
}

model Set {
  set_id           String           @id @default(cuid())
  sched_id         String
  seat_category_id String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  seatAssignments  SeatAssignment[]
  sched            Sched            @relation(fields: [sched_id], references: [sched_id])
  seatCategory     SeatCategory     @relation(fields: [seat_category_id], references: [seat_category_id])

  @@unique([sched_id, seat_category_id])
  @@unique([set_id, sched_id])
  @@index([sched_id])
  @@index([seat_category_id])
}

model SeatAssignment {
  seat_assignment_id String        @id @default(cuid())
  seat_status        SeatStatus    @default(OPEN)
  seat_id            String
  sched_id           String
  set_id             String
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  reservedSeats      ReservedSeat[]
  sched              Sched         @relation(fields: [sched_id], references: [sched_id])
  seat               Seat          @relation(fields: [seat_id], references: [seat_id])
  set                Set           @relation(fields: [set_id, sched_id], references: [set_id, sched_id])

  @@unique([seat_id, sched_id])
  @@index([sched_id])
  @@index([seat_id])
  @@index([set_id])
}

model Reservation {
  reservation_id String            @id @default(cuid())
  user_id        String
  show_id        String
  sched_id       String
  status         ReservationStatus @default(PENDING)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  payment        Payment?
  user           User              @relation(fields: [user_id], references: [user_id])
  show           Show              @relation(fields: [show_id], references: [show_id])
  sched          Sched             @relation(fields: [sched_id], references: [sched_id])
  reservedSeats  ReservedSeat[]

  @@index([user_id])
  @@index([show_id])
  @@index([sched_id])
}

model Payment {
  payment_id     String        @id @default(cuid())
  reservation_id String        @unique
  amount         Decimal       @db.Decimal(10, 2)
  method         PaymentMethod
  status         PaymentStatus @default(PENDING)
  reference_no   String?       @unique
  screenshot_url String?
  paid_at        DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  reservation    Reservation   @relation(fields: [reservation_id], references: [reservation_id])

  @@index([reservation_id])
}

model ReservedSeat {
  res_seats_id       String         @id @default(cuid())
  reservation_id     String
  seat_assignment_id String
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  reservation        Reservation    @relation(fields: [reservation_id], references: [reservation_id])
  seatAssignment     SeatAssignment @relation(fields: [seat_assignment_id], references: [seat_assignment_id])

  @@map("reserved_seats")
  @@index([reservation_id])
  @@index([seat_assignment_id])
}

model Review {
  review_id String   @id @default(cuid())
  user_id   String
  show_id   String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  show      Show     @relation(fields: [show_id], references: [show_id])
  user      User     @relation(fields: [user_id], references: [user_id])

  @@unique([user_id, show_id])
  @@index([user_id])
  @@index([show_id])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum ShowStatus {
  UPCOMING
  DRAFT
  OPEN
  CLOSED
  ON_GOING
  CANCELLED
  POSTPONED
}

enum SeatmapStatus {
  ACTIVE
  DISABLED
}

enum ColorCodes {
  NO_COLOR @map("NO COLOR")
  GOLD     @map("#ffd700")
  PINK     @map("#e005b9")
  BLUE     @map("#111184")
  BURGUNDY @map("#800020")
  GREEN    @map("#046307")
}

enum SeatStatus {
  OPEN
  RESERVED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  EXPIRED
}

enum PaymentMethod {
  CASH
  GCASH
  MAYA
  CREDIT_CARD
  BANK_TRANSFER
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
